{% extends "admin_tw_base.html" %}
{% block title %}Admin Â· Dashboard{% endblock %}
{% block content %}
<div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
  <div class="rounded-xl border border-slate-700 bg-slate-800 p-4"><div class="text-slate-400 text-sm">Total Users</div><div class="text-2xl font-semibold">{{ stats.total_users }}</div></div>
  <div class="rounded-xl border border-slate-700 bg-slate-800 p-4"><div class="text-slate-400 text-sm">Active Users</div><div class="text-2xl font-semibold">{{ stats.active_users }}</div></div>
  <div class="rounded-xl border border-slate-700 bg-slate-800 p-4"><div class="text-slate-400 text-sm">Total Bookings</div><div class="text-2xl font-semibold">{{ stats.total_bookings }}</div></div>
  <div class="rounded-xl border border-slate-700 bg-slate-800 p-4"><div class="text-slate-400 text-sm">Courts</div><div class="text-2xl font-semibold">{{ stats.total_courts }}</div></div>
</div>

<ul id="chart-labels" class="hidden">
  {% for l in bookings_labels %}<li>{{ l }}</li>{% endfor %}
</ul>
<ul id="chart-counts" class="hidden">
  {% for c in bookings_counts %}<li>{{ c }}</li>{% endfor %}
</ul>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
  <div class="lg:col-span-2 rounded-xl border border-slate-700 bg-slate-800 p-4">
    <div class="flex items-center justify-between mb-2"><h3 class="font-semibold">Bookings (last 14 days)</h3></div>
    <canvas id="chartBookings" height="120"></canvas>
  </div>
  <div class="rounded-xl border border-slate-700 bg-slate-800 p-4">
    <h3 class="font-semibold mb-2">Users status</h3>
    <canvas id="chartUsers" height="180"></canvas>
    <div id="user-stats" class="hidden">
      <span data-active="{{ stats.active_users }}"></span>
      <span data-inactive="{{ stats.inactive_users }}"></span>
    </div>
  </div>
</div>

<h3 class="mt-6 mb-2 font-semibold">Recent bookings</h3>
<div class="overflow-hidden rounded-xl border border-slate-700">
  <table class="w-full text-sm">
    <thead class="bg-slate-800/70 text-slate-300">
      <tr><th class="text-left p-3">ID</th><th class="text-left p-3">User</th><th class="text-left p-3">Court</th><th class="text-left p-3">Date</th><th class="text-left p-3">Start</th><th class="text-left p-3">End</th></tr>
    </thead>
    <tbody class="divide-y divide-slate-700">
      {% for b in bookings %}
      <tr class="hover:bg-slate-800/40">
        <td class="p-3">{{ b.id }}</td><td class="p-3">{{ b.username }}</td><td class="p-3">{{ b.court_name }}</td><td class="p-3">{{ b.booking_date }}</td><td class="p-3">{{ b.start_time }}</td><td class="p-3">{{ b.end_time }}</td>
      </tr>
      {% else %}
      <tr><td class="p-4 text-slate-400" colspan="6">No bookings.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
<script>
  const labels = Array.from(document.querySelectorAll('#chart-labels li')).map(li => li.textContent.trim());
  const counts = Array.from(document.querySelectorAll('#chart-counts li')).map(li => parseInt(li.textContent.trim() || '0', 10));
  const statsEl = document.querySelector('#user-stats');
  const activeUsers = statsEl ? parseInt(statsEl.querySelector('[data-active]')?.dataset.active || '0', 10) : 0;
  const inactiveUsers = statsEl ? parseInt(statsEl.querySelector('[data-inactive]')?.dataset.inactive || '0', 10) : 0;

  const ctx1 = document.getElementById('chartBookings');
  if (ctx1) new Chart(ctx1, {
    type: 'line',
    data: { labels, datasets: [{ data: counts, label: 'Bookings', borderColor: '#60a5fa', backgroundColor: 'rgba(96,165,250,.15)', tension:.35, fill:true }]},
    options:{ plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}
  });

  const ctx2 = document.getElementById('chartUsers');
  if (ctx2) new Chart(ctx2, {
    type: 'doughnut',
    data:{ labels:['Active','Inactive'], datasets:[{ data:[activeUsers, inactiveUsers], backgroundColor:['#22c55e','#64748b'] }]},
    options:{ plugins:{legend:{position:'bottom'}} }
  });
</script>
{% endblock %}